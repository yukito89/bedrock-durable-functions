# é€²æ—è¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

Azure Blob Storageã‚’åˆ©ç”¨ã—ã¦ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‡¦ç†é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§UIã«åæ˜ ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯10ç§’é–“éš”ã§ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã„ã€é€²æ—çŠ¶æ³ã‚’å–å¾—ã—ã¾ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  10ç§’ãƒãƒ¼ãƒªãƒ³ã‚°  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  é€²æ—æ›´æ–°  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆ    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ Azure        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ â”‚
â”‚ ã‚¨ãƒ³ãƒ‰      â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Functions    â”‚            â”‚ å‡¦ç†        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  é€²æ—ãƒ‡ãƒ¼ã‚¿å–å¾—  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚ Azure Blob  â”‚
                                 â”‚ Storage     â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®Ÿè£…å†…å®¹

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: `core/progress_manager.py`
- Azure Blob Storageã‚’ä½¿ç”¨ã—ãŸé€²æ—ç®¡ç†ã‚¯ãƒ©ã‚¹
- é€²æ—ã®æ›´æ–°ã€å–å¾—ã€å‰Šé™¤æ©Ÿèƒ½ã‚’æä¾›

#### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `core/normal_mode.py`, `core/diff_mode.py`
- å„å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¸ã§é€²æ—ã‚’æ›´æ–°
- ã‚¹ãƒ†ãƒ¼ã‚¸: æ§‹é€ åŒ– â†’ ãƒ†ã‚¹ãƒˆè¦³ç‚¹æŠ½å‡º â†’ ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ç”Ÿæˆ â†’ å¤‰æ› â†’ å®Œäº†

#### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `function_app.py`
- ã‚¸ãƒ§ãƒ–IDã®ç”Ÿæˆã¨ç®¡ç†
- æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `GET /api/progress/{job_id}` - é€²æ—å–å¾—API

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `frontend/script.js`
- 10ç§’é–“éš”ã®ãƒãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½
- é€²æ—ãƒãƒ¼ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
- ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã®çµµæ–‡å­—ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

#### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `frontend/index.html`
- é€²æ—ãƒãƒ¼è¦ç´ ã®è¿½åŠ 

#### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `frontend/style.css`
- é€²æ—ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. Azure Storage Accountã®ä½œæˆ

#### Azureãƒãƒ¼ã‚¿ãƒ«ã§ã®ä½œæˆæ‰‹é †

1. **Azureãƒãƒ¼ã‚¿ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹**
   - https://portal.azure.com ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚µã‚¤ãƒ³ã‚¤ãƒ³

2. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ**
   - å·¦ä¸Šã®ã€Œãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«ã€Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã¨å…¥åŠ›ã—ã¦é¸æŠž
   - ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

3. **åŸºæœ¬è¨­å®š**
   - **ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³**: ä½¿ç”¨ã™ã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠž
   - **ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**: æ—¢å­˜ã®ã‚‚ã®ã‚’é¸æŠžã€ã¾ãŸã¯ã€Œæ–°è¦ä½œæˆã€
   - **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå**: ä¸€æ„ã®åå‰ã‚’å…¥åŠ›ï¼ˆä¾‹: `testgenprogress`ï¼‰
   - **åœ°åŸŸ**: Function Appã¨åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŽ¨å¥¨ï¼ˆä¾‹: Japan Eastï¼‰
   - **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹**: ã€ŒStandardã€ã‚’é¸æŠž
   - **å†—é•·æ€§**: ã€Œãƒ­ãƒ¼ã‚«ãƒ«å†—é•·ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ (LRS)ã€ã‚’é¸æŠžï¼ˆã‚³ã‚¹ãƒˆæœ€é©åŒ–ï¼‰

4. **è©³ç´°è¨­å®š**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾ã€Œæ¬¡ã¸ã€

5. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**
   - ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ã€ã‚’é¸æŠž
   - ã€Œæ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

6. **ãƒ‡ãƒ¼ã‚¿ä¿è­·**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾ã€Œæ¬¡ã¸ã€

7. **ç¢ºèªã¨ä½œæˆ**
   - è¨­å®šå†…å®¹ã‚’ç¢ºèª
   - ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã¾ã§å¾…æ©Ÿï¼ˆé€šå¸¸1-2åˆ†ï¼‰

8. **æŽ¥ç¶šæ–‡å­—åˆ—ã®å–å¾—**
   - ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€ã€Œãƒªã‚½ãƒ¼ã‚¹ã«ç§»å‹•ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã€ã‚’é¸æŠž
   - ã€Œã‚­ãƒ¼ã®è¡¨ç¤ºã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - **key1**ã®ã€ŒæŽ¥ç¶šæ–‡å­—åˆ—ã€ã‚’ã‚³ãƒ”ãƒ¼

9. **ç’°å¢ƒå¤‰æ•°ã¸ã®è¨­å®š**
   - `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
   - ä»¥ä¸‹ã‚’è¿½åŠ :
   ```
   AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=testgenprogress;AccountKey=...;EndpointSuffix=core.windows.net
   ```

### 2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

### 3. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å‹•ä½œç¢ºèª

```bash
func start
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€é€²æ—ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## é€²æ—ã‚¹ãƒ†ãƒ¼ã‚¸

| ã‚¹ãƒ†ãƒ¼ã‚¸ | é€²æ—çŽ‡ | è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|---------|--------|---------------|
| structuring | 10% | ðŸ“„ è¨­è¨ˆæ›¸ã‚’æ§‹é€ åŒ–ä¸­... |
| diff | 30% | ðŸ” å·®åˆ†ã‚’æ¤œçŸ¥ä¸­... (å·®åˆ†ãƒ¢ãƒ¼ãƒ‰ã®ã¿) |
| perspectives | 40-50% | ðŸ’¡ ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã‚’æŠ½å‡ºä¸­... |
| testspec | 70% | ðŸ“ ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’ç”Ÿæˆä¸­... |
| converting | 90% | ðŸ”„ æˆæžœç‰©ã‚’å¤‰æ›ä¸­... |
| completed | 100% | âœ… å®Œäº†ã—ã¾ã—ãŸ |

## APIä»•æ§˜

### é€²æ—å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/progress/{job_id}`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "stage": "testspec",
  "message": "ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’ç”Ÿæˆä¸­...",
  "progress": 70,
  "timestamp": "2024-01-15T10:30:00.000000"
}
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### é€²æ—ãŒæ›´æ–°ã•ã‚Œãªã„å ´åˆ

1. Azure StorageæŽ¥ç¶šæ–‡å­—åˆ—ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. Blob Storageã®`progress`ã‚³ãƒ³ãƒ†ãƒŠãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

### ãƒãƒ¼ãƒªãƒ³ã‚°ãŒåœæ­¢ã—ãªã„å ´åˆ

- ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ãƒãƒ¼ãƒªãƒ³ã‚°ã¯è‡ªå‹•çš„ã«åœæ­¢ã—ã¾ã™
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã‚‚è‡ªå‹•çš„ã«åœæ­¢ã—ã¾ã™

## æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. Function Appã¸ã®ç’°å¢ƒå¤‰æ•°è¨­å®š

1. Azureãƒãƒ¼ã‚¿ãƒ«ã§ä½œæˆã—ãŸFunction Appã‚’é–‹ã
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œè¨­å®šã€â†’ã€Œç’°å¢ƒå¤‰æ•°ã€ã‚’é¸æŠž
3. ã€Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã€ã‚¿ãƒ–ã§ã€Œ+è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã‚’å…¥åŠ›:
   - **åå‰**: `AZURE_STORAGE_CONNECTION_STRING`
   - **å€¤**: Storage Accountã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸæŽ¥ç¶šæ–‡å­—åˆ—
5. ã€Œé©ç”¨ã€â†’ã€Œç¢ºèªã€ã‚’ã‚¯ãƒªãƒƒã‚¯
6. Function AppãŒå†èµ·å‹•ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¨­å®šå¤‰æ›´

`frontend/script.js`ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã‚’æœ¬ç•ªç’°å¢ƒã«å¤‰æ›´:
```javascript
// æœ¬ç•ªç’°å¢ƒç”¨ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è§£é™¤
const progressEndpoint = `https://your-function-app.azurewebsites.net/api/progress/${jobId}`;
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

VS Codeã‹ã‚‰é€šå¸¸é€šã‚Šãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ

## ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

- WebSocketã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- é€²æ—ã®è©³ç´°ãƒ­ã‚°è¡¨ç¤º
- è¤‡æ•°ã‚¸ãƒ§ãƒ–ã®åŒæ™‚é€²æ—ç®¡ç†
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è©³ç´°æƒ…å ±è¡¨ç¤º
